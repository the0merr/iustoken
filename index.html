// Importing necessary libraries
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let bird = {
    x: 50,
    y: 150,
    width: 20,
    height: 20,
    gravity: 0.6,
    lift: -15,
    velocity: 0
};

let pipes = [];
let frame = 0;
let score = 0;
let gameOver = false;

function setup() {
    document.addEventListener('keydown', () => {
        if (!gameOver) {
            bird.velocity += bird.lift;
        } else {
            resetGame();
        }
    });
    requestAnimationFrame(loop);
}

function loop() {
    if (!gameOver) {
        update();
        draw();
        frame++;
        if (frame % 75 === 0) {
            pipes.push(new Pipe());
        }
        checkCollision();
    } else {
        drawGameOver();
    }
    requestAnimationFrame(loop);
}

function update() {
    bird.velocity += bird.gravity;
    bird.y += bird.velocity;

    if (bird.y > canvas.height) {
        gameOver = true;
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = 'skyblue';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = 'yellow';
    ctx.fillRect(bird.x, bird.y, bird.width, bird.height);

    for (let pipe of pipes) {
        pipe.update();
        pipe.show();
        if (pipe.offscreen()) {
            pipes.splice(pipes.indexOf(pipe), 1);
            score++;
        }
    }

    ctx.fillStyle = 'black';
    ctx.font = '20px Arial';
    ctx.fillText('Score: ' + score, 10, 20);
}

function checkCollision() {
    for (let pipe of pipes) {
        if (bird.x < pipe.x + pipe.width && bird.x + bird.width > pipe.x && bird.y < pipe.top && bird.y + bird.height > 0) {
            gameOver = true;
        }
        if (bird.x < pipe.x + pipe.width && bird.x + bird.width > pipe.x && bird.y + bird.height > pipe.bottom) {
            gameOver = true;
        }
    }
}

function drawGameOver() {
    ctx.fillStyle = 'red';
    ctx.font = '40px Arial';
    ctx.fillText('Game Over', canvas.width / 2 - 100, canvas.height / 2);
    ctx.font = '20px Arial';
    ctx.fillText('Press any key to restart', canvas.width / 2 - 120, canvas.height / 2 + 30);
}

function resetGame() {
    bird.y = 150;
    bird.velocity = 0;
    pipes = [];
    score = 0;
    gameOver = false;
    frame = 0;
}

class Pipe {
    constructor() {
        this.width = 50;
        this.top = Math.random() * (canvas.height - 100) + 20;
        this.bottom = canvas.height - (this.top + 150);
        this.x = canvas.width;
        this.speed = 2;
    }

    update() {
        this.x -= this.speed;
    }

    show() {
        ctx.fillStyle = 'green';
        ctx.fillRect(this.x, 0, this.width, this.top);
        ctx.fillRect(this.x, canvas.height - this.bottom, this.width, this.bottom);
    }

    offscreen() {
        return this.x < -this.width;
    }
}

setup();
